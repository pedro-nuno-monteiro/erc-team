\hypertarget{fila1s_8c}{}\doxysection{fila1s.\+c File Reference}
\label{fila1s_8c}\index{fila1s.c@{fila1s.c}}
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include \char`\"{}lcgrand.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}fila\+\_\+circular.\+h\char`\"{}}\newline
\doxysubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{struct_queue_system}{Queue\+System}}
\end{DoxyCompactItemize}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{fila1s_8c_aaa75be566c9c8da967954407ca97c72b}{Q\+\_\+\+LIMIT}}~200
\item 
\#define \mbox{\hyperlink{fila1s_8c_ab5be0aaddb58ffb9cb20c12530d66316}{BUSY}}~1
\item 
\#define \mbox{\hyperlink{fila1s_8c_a9c21a7caee326d7803b94ae1952b27ca}{IDLE}}~0
\item 
\#define \mbox{\hyperlink{fila1s_8c_af076440f216f5a40a11563e489f04932}{INFINITO}}~1e+30
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
float \mbox{\hyperlink{fila1s_8c_ad3058f8628cdcdec85698cbf472abd86}{expon}} (float mean, int stream)
\item 
int \mbox{\hyperlink{fila1s_8c_ac22a2caae0228237c6bfae92a0d1a258}{select\+Free\+Server}} (const \mbox{\hyperlink{struct_queue_system}{Queue\+System}} $\ast$system)
\item 
void \mbox{\hyperlink{fila1s_8c_aaf21db29e2fafb628749585a27cc3df9}{initialize}} (\mbox{\hyperlink{struct_queue_system}{Queue\+System}} $\ast$system)
\item 
void \mbox{\hyperlink{fila1s_8c_a5b5a613c9a22e76d71cacfa6a69ae06c}{report}} (const \mbox{\hyperlink{struct_queue_system}{Queue\+System}} $\ast$system, FILE $\ast$outfile)
\item 
void \mbox{\hyperlink{fila1s_8c_aa1b9ebf0bf3a71d378b43e6be9e53f21}{update\+\_\+time\+\_\+avg\+\_\+stats}} (\mbox{\hyperlink{struct_queue_system}{Queue\+System}} $\ast$system)
\item 
void \mbox{\hyperlink{fila1s_8c_a23acade1cbd114aa99fc7dd7d494349e}{timing}} (\mbox{\hyperlink{struct_queue_system}{Queue\+System}} $\ast$system)
\item 
void \mbox{\hyperlink{fila1s_8c_a647e0eb3faf34fb21572bbd89fe8ef1a}{arrive}} (\mbox{\hyperlink{struct_queue_system}{Queue\+System}} $\ast$system)
\item 
void \mbox{\hyperlink{fila1s_8c_a25fcb4521bc8406bf696425b216552d2}{depart}} (\mbox{\hyperlink{struct_queue_system}{Queue\+System}} $\ast$system)
\item 
int \mbox{\hyperlink{fila1s_8c_ae66f6b31b5ad750f1fe042a706a4e3d4}{main}} ()
\end{DoxyCompactItemize}


\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{fila1s_8c_ab5be0aaddb58ffb9cb20c12530d66316}\label{fila1s_8c_ab5be0aaddb58ffb9cb20c12530d66316}} 
\index{fila1s.c@{fila1s.c}!BUSY@{BUSY}}
\index{BUSY@{BUSY}!fila1s.c@{fila1s.c}}
\doxysubsubsection{\texorpdfstring{BUSY}{BUSY}}
{\footnotesize\ttfamily \#define BUSY~1}

\mbox{\Hypertarget{fila1s_8c_a9c21a7caee326d7803b94ae1952b27ca}\label{fila1s_8c_a9c21a7caee326d7803b94ae1952b27ca}} 
\index{fila1s.c@{fila1s.c}!IDLE@{IDLE}}
\index{IDLE@{IDLE}!fila1s.c@{fila1s.c}}
\doxysubsubsection{\texorpdfstring{IDLE}{IDLE}}
{\footnotesize\ttfamily \#define IDLE~0}

\mbox{\Hypertarget{fila1s_8c_af076440f216f5a40a11563e489f04932}\label{fila1s_8c_af076440f216f5a40a11563e489f04932}} 
\index{fila1s.c@{fila1s.c}!INFINITO@{INFINITO}}
\index{INFINITO@{INFINITO}!fila1s.c@{fila1s.c}}
\doxysubsubsection{\texorpdfstring{INFINITO}{INFINITO}}
{\footnotesize\ttfamily \#define INFINITO~1e+30}

\mbox{\Hypertarget{fila1s_8c_aaa75be566c9c8da967954407ca97c72b}\label{fila1s_8c_aaa75be566c9c8da967954407ca97c72b}} 
\index{fila1s.c@{fila1s.c}!Q\_LIMIT@{Q\_LIMIT}}
\index{Q\_LIMIT@{Q\_LIMIT}!fila1s.c@{fila1s.c}}
\doxysubsubsection{\texorpdfstring{Q\_LIMIT}{Q\_LIMIT}}
{\footnotesize\ttfamily \#define Q\+\_\+\+LIMIT~200}



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{fila1s_8c_a647e0eb3faf34fb21572bbd89fe8ef1a}\label{fila1s_8c_a647e0eb3faf34fb21572bbd89fe8ef1a}} 
\index{fila1s.c@{fila1s.c}!arrive@{arrive}}
\index{arrive@{arrive}!fila1s.c@{fila1s.c}}
\doxysubsubsection{\texorpdfstring{arrive()}{arrive()}}
{\footnotesize\ttfamily void arrive (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_queue_system}{Queue\+System}} $\ast$}]{system }\end{DoxyParamCaption})}

idseq\mbox{[}1\mbox{]} está o indentificadir da sequencia usada para as chegadas

Verificar se o servidor está ocupado

Usando a função select\+\_\+server que verifica se existe um servidor não ocupado se o resultado for -\/1 então os servidotres estão todos ocupados logo o cliente não é logo atendido if (select\+\_\+server(server\+\_\+status, $\ast$num\+\_\+servers) == -\/1) \{

Se ele estiver ocupado adiciona mais um cliente à fila circular

incrementa o numero de chamadas perdidas

Servidor estiver Disponivel o atraso do cliente começa a zero seleciona o servidor disponivel se o servidor que for ocupado, passa a estar ocupado\mbox{\Hypertarget{fila1s_8c_a25fcb4521bc8406bf696425b216552d2}\label{fila1s_8c_a25fcb4521bc8406bf696425b216552d2}} 
\index{fila1s.c@{fila1s.c}!depart@{depart}}
\index{depart@{depart}!fila1s.c@{fila1s.c}}
\doxysubsubsection{\texorpdfstring{depart()}{depart()}}
{\footnotesize\ttfamily void depart (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_queue_system}{Queue\+System}} $\ast$}]{system }\end{DoxyParamCaption})}

função responsavel por processar o cliente que sai da fila Teste Debug-- Mensagens de ERRO

variavel auxiliar

Verifica se a fila esta vazia

fila vazia ou sistema com perda

se tem perda acabou (não faz mais nada)

Se não há clientes à espera significa q o servidor concluiu o serviço ~\newline
 passa a estar desocupado

vem para aqui se for um sistema com fila e esta não estiver vazia

int inf= para testar se correu bem

front\+\_\+time corresponde ao time\+\_\+arrival\mbox{[}1\mbox{]} na fila não circular

calcula o atraso do cliente q esta a iniciar o serviço e atualiza o contador de atraso

aumenta o numero de clientes atrasados e agenda a saida

antes era sempre 2 agora é do 2 ate ao num\+\_\+server+1\mbox{\Hypertarget{fila1s_8c_ad3058f8628cdcdec85698cbf472abd86}\label{fila1s_8c_ad3058f8628cdcdec85698cbf472abd86}} 
\index{fila1s.c@{fila1s.c}!expon@{expon}}
\index{expon@{expon}!fila1s.c@{fila1s.c}}
\doxysubsubsection{\texorpdfstring{expon()}{expon()}}
{\footnotesize\ttfamily float expon (\begin{DoxyParamCaption}\item[{float}]{mean,  }\item[{int}]{stream }\end{DoxyParamCaption})}

Retorna uma variavel aleatoria exponencial com media \char`\"{}mean\char`\"{} Função para gerar uma variavel exponencial\mbox{\Hypertarget{fila1s_8c_aaf21db29e2fafb628749585a27cc3df9}\label{fila1s_8c_aaf21db29e2fafb628749585a27cc3df9}} 
\index{fila1s.c@{fila1s.c}!initialize@{initialize}}
\index{initialize@{initialize}!fila1s.c@{fila1s.c}}
\doxysubsubsection{\texorpdfstring{initialize()}{initialize()}}
{\footnotesize\ttfamily void initialize (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_queue_system}{Queue\+System}} $\ast$}]{system }\end{DoxyParamCaption})}

a tabela server\+\_\+status só é usada no indice 2 até num\+\_\+servers+1 (se o numero de servidores for 1 só é usado o indice 2) time\+\_\+next\+\_\+event indice zero indica que não há mais eventos indice 1 indica uma chegada indice 2 até num\+\_\+servers+1 indica uma partida nesse servidor se o time\+\_\+next\+\_\+event nesse indice for diferente de infinito inicializa as variaveis com valores iniciais

tempo de simulação começa a zero

os clientes na fila começam a zero

tempo do ultimo evento começa a zero

numero de clientes atendidos começa a zero

o total de atrasos começa a zero

Atualização do número de eventos

Inicializa a fila circular

estado inicial dos servidores como IDLE

isto são as partidas

inicializa as sementes a usar para chegadas (1) e tempos de serviço (2 ate num\+\_\+servers+1) zero n é usado

gera a primeira chegada\mbox{\Hypertarget{fila1s_8c_ae66f6b31b5ad750f1fe042a706a4e3d4}\label{fila1s_8c_ae66f6b31b5ad750f1fe042a706a4e3d4}} 
\index{fila1s.c@{fila1s.c}!main@{main}}
\index{main@{main}!fila1s.c@{fila1s.c}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

zero n é usado a capacidade minima deve de ser smp num\+\_\+serveres+1 uma vez que vamos precisar de ter eventos por servidor mais um para as chegadas, podemos usar um truque seguinte\+: time\+\_\+next\+\_\+event\mbox{[}0... numservers -\/1\mbox{]} tem o instante de partida desse servidor ou um valor muito elevado \char`\"{}infinito \char`\"{} (chamamos uma constante omeuinfinito=biblioteca-\/-\/\texorpdfstring{$>$}{>}climits=floats=FLT\+\_\+\+MAX (incluir biblioteca)) time\+\_\+next\+\_\+event\mbox{[}numserveers\mbox{]} passa ser a chegada seguinte ~\newline


Modificacoes para lidar com os multiplos servidores

Inicilaiza as variaveis do sistema

Vamos usar um while para percorrer todos os clientes atendidos ate atingir o numero de clientes pretendidos

Verificar se há eventos agendados

se o proximo evento for uma chegada

se o proximo evento for uma saida

se n for uma saida ou uma chegada então ERRO

Gera o relatorio final

Fecha os ficheiros\mbox{\Hypertarget{fila1s_8c_a5b5a613c9a22e76d71cacfa6a69ae06c}\label{fila1s_8c_a5b5a613c9a22e76d71cacfa6a69ae06c}} 
\index{fila1s.c@{fila1s.c}!report@{report}}
\index{report@{report}!fila1s.c@{fila1s.c}}
\doxysubsubsection{\texorpdfstring{report()}{report()}}
{\footnotesize\ttfamily void report (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct_queue_system}{Queue\+System}} $\ast$}]{system,  }\item[{FILE $\ast$}]{outfile }\end{DoxyParamCaption})}

relatorio do desempenho do sistema de fila

imprime a media do atraso na fila por cliente

imprime a media do numero de clientes na fila

imprime a utilização media dos servidores

imprime o tempo total da simulação.

imprime o numero de clientes perdidos\mbox{\Hypertarget{fila1s_8c_ac22a2caae0228237c6bfae92a0d1a258}\label{fila1s_8c_ac22a2caae0228237c6bfae92a0d1a258}} 
\index{fila1s.c@{fila1s.c}!selectFreeServer@{selectFreeServer}}
\index{selectFreeServer@{selectFreeServer}!fila1s.c@{fila1s.c}}
\doxysubsubsection{\texorpdfstring{selectFreeServer()}{selectFreeServer()}}
{\footnotesize\ttfamily int select\+Free\+Server (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct_queue_system}{Queue\+System}} $\ast$}]{system }\end{DoxyParamCaption})}

função para selecionar um servidor disponivel o estado de cada servidor ou IDLE ou BUSY \begin{DoxyReturn}{Returns}
devolve o primeiro servidor livre ou -\/1 se tiverem todos ocupados 
\end{DoxyReturn}
percorrre a lista de servidores

server\+\_\+status--um array que indica on estado de cada servidor (IDLE ou BUSY) num\+\_\+servers--numero total de servidores no sistema

retorna o indice do primeiro servidor diponivel

retorna -\/1 se todos os servidores estiverem ocupados\mbox{\Hypertarget{fila1s_8c_a23acade1cbd114aa99fc7dd7d494349e}\label{fila1s_8c_a23acade1cbd114aa99fc7dd7d494349e}} 
\index{fila1s.c@{fila1s.c}!timing@{timing}}
\index{timing@{timing}!fila1s.c@{fila1s.c}}
\doxysubsubsection{\texorpdfstring{timing()}{timing()}}
{\footnotesize\ttfamily void timing (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_queue_system}{Queue\+System}} $\ast$}]{system }\end{DoxyParamCaption})}

determinar o prox evento e avanca o tempo da simulacao

experimentar depois só com infinito

caso em que a fila está vazia

identifica o servidor a libertar para saber na função depart (é o que tem menor tempo)

fprintf(stderr, \char`\"{}\textbackslash{}n\+Timming\+: system-\/$>$next\+\_\+event\+\_\+type==\%d\char`\"{}, system-\/\texorpdfstring{$>$}{>}next\+\_\+event\+\_\+type);

if (system-\/\texorpdfstring{$>$}{>}server\+\_\+status\mbox{[}system-\/\texorpdfstring{$>$}{>}next\+\_\+event\+\_\+type\mbox{]}\texorpdfstring{$>$}{>}=2)\{ fprintf(stderr, \char`\"{}\textbackslash{}n\+Timming\+: system-\/$>$server\+\_\+status\mbox{[}system-\/$>$next\+\_\+event\+\_\+type\mbox{]}==\%d\char`\"{}, system-\/\texorpdfstring{$>$}{>}server\+\_\+status\mbox{[}system-\/\texorpdfstring{$>$}{>}next\+\_\+event\+\_\+type\mbox{]}); \}

Verifica se a lista de eventos esta vazia.

A lista de eventos está vazia, então a simulação para.

Se a lista de eventos nao esta vazia então a simulacao para

avanca o tempo da simulacao para o tempo do prox evento

Para calcular e atualizar as estatisticas de tempo medio relacionadas ao nº de clientes na fila e estado dos servidores\mbox{\Hypertarget{fila1s_8c_aa1b9ebf0bf3a71d378b43e6be9e53f21}\label{fila1s_8c_aa1b9ebf0bf3a71d378b43e6be9e53f21}} 
\index{fila1s.c@{fila1s.c}!update\_time\_avg\_stats@{update\_time\_avg\_stats}}
\index{update\_time\_avg\_stats@{update\_time\_avg\_stats}!fila1s.c@{fila1s.c}}
\doxysubsubsection{\texorpdfstring{update\_time\_avg\_stats()}{update\_time\_avg\_stats()}}
{\footnotesize\ttfamily void update\+\_\+time\+\_\+avg\+\_\+stats (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_queue_system}{Queue\+System}} $\ast$}]{system }\end{DoxyParamCaption})}

Função que atualiza ass estatisticas do codigo tempo decorrido desde do ultimo evento

atualiza o tempo do ultimo evento para o tempo atual

se o sistema tem fila de espera atualiza a area da função number\+\_\+queue permite calcular o n de utilizadores na fila de espera

atualiza a area media ponderada do numero de clientes na fila para cada servidor